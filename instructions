üß¨ Galaxy Offline Install on RHEL 9 (Authoritative Runbook)

Tested scenario

RHEL 9.x

Online ‚Äústaging‚Äù VM with internet

Offline / air-gapped target with only BaseOS + AppStream

Single transfer preferred

No Gravity required

Runs as non-root galaxy user

PART 0 ‚Äî Accounts & system prep (ONLINE + OFFLINE)
Required users

Create once on both systems:

sudo useradd -r -m -d /home/galaxy -s /bin/bash galaxy

PART 1 ‚Äî Online system: prepare offline bundle
1. Enable required RHEL repos (online system)
sudo subscription-manager repos \
  --enable=rhel-9-for-x86_64-baseos-rpms \
  --enable=rhel-9-for-x86_64-appstream-rpms

2. Create working directories
mkdir -p /srv/galaxy-offline/{rpms,pip}
mkdir -p /root/galaxy-src

3. Download Galaxy source
cd /root/galaxy-src
git clone https://github.com/galaxyproject/galaxy.git
cd galaxy


(Stick to default branch unless you need a specific release.)

4. Download ALL required system RPMs (one time)
sudo dnf download \
  --resolve \
  --alldeps \
  --destdir=/srv/galaxy-offline/rpms \
  gcc gcc-c++ make \
  python3 python3-devel python3-pip \
  libffi-devel openssl-devel \
  bzip2-devel zlib-devel \
  sqlite sqlite-devel \
  nodejs git rsync wget curl


Create offline repo metadata:

sudo createrepo_c /srv/galaxy-offline/rpms

5. Download ALL Python dependencies (offline pip cache)
cd /root/galaxy-src/galaxy
python3 -m venv .venv
source .venv/bin/activate

pip install --upgrade pip setuptools wheel

pip download \
  --dest /srv/galaxy-offline/pip \
  -r requirements.txt


‚ö†Ô∏è Critical: this step must complete without errors.

6. Build Galaxy client (ONLINE ONLY)

This avoids Node/Vite memory pain offline.

make client-production

7. Remove large runtime junk (before packaging)
rm -rf database/dependencies/_conda
rm -rf database/jobs database/objects

8. Fix permissions (important)
sudo chmod -R a+rX /srv/galaxy-offline

9. Create the ONE transfer bundle
sudo tar -czf /root/galaxy-airgap-bundle.tar.gz \
  /srv/galaxy-offline \
  /root/galaxy-src/galaxy


‚úÖ This is the only file you need to move

PART 2 ‚Äî Transfer to offline system

Use any approved method:

USB

Secure copy via jump host

Approved file gateway

Place it at:

/root/galaxy-airgap-bundle.tar.gz

PART 3 ‚Äî Offline system: install Galaxy
10. Extract bundle
cd /
sudo tar -xzf /root/galaxy-airgap-bundle.tar.gz


You should now have:

/srv/galaxy-offline

/root/galaxy-src/galaxy

11. Configure offline RPM repo
sudo tee /etc/yum.repos.d/galaxy-offline.repo <<EOF
[galaxy-offline]
name=Galaxy Offline Repo
baseurl=file:///srv/galaxy-offline/rpms
enabled=1
gpgcheck=0
EOF


Disable other repos:

sudo mv /etc/yum.repos.d/redhat.repo /etc/yum.repos.d/redhat.repo.disabled
sudo dnf clean all

12. Install system dependencies (OFFLINE)
sudo dnf install -y \
  gcc gcc-c++ make \
  python3 python3-devel python3-pip \
  libffi-devel openssl-devel \
  bzip2-devel zlib-devel \
  sqlite sqlite-devel \
  nodejs git rsync wget curl \
  --disablerepo="*" \
  --enablerepo="galaxy-offline"

13. Move Galaxy to galaxy user (no copy, no duplication)
sudo mkdir -p /home/galaxy/galaxy
sudo rsync -a --remove-source-files /root/galaxy-src/galaxy/ /home/galaxy/galaxy/
sudo chown -R galaxy:galaxy /home/galaxy/galaxy

14. Offline Python install (galaxy user)
sudo -u galaxy bash -lc '
cd /home/galaxy/galaxy
python3 -m venv .venv
source .venv/bin/activate
python -m pip install --upgrade pip setuptools wheel \
  --no-index --find-links=file:///srv/galaxy-offline/pip
python -m pip install \
  --no-index --find-links=file:///srv/galaxy-offline/pip \
  -r requirements.txt
'

15. Configure Galaxy
sudo -u galaxy bash -lc '
cd /home/galaxy/galaxy
cp config/galaxy.yml.sample config/galaxy.yml
'


(Optional: set admin user, database path, etc.)

16. Start Galaxy (NO Gravity)
sudo -u galaxy bash -lc '
cd /home/galaxy/galaxy
source .venv/bin/activate
bash ./run.sh
'

17. Test
curl -I http://localhost:8080


‚úÖ Galaxy UI should load.

Running Galaxy as a systemd Service (Offline Production)

This section describes how to run Galaxy as a persistent system service on an offline RHEL 9 system, using a dedicated galaxy user and a Python virtual environment.
This is the recommended production approach.

Prerequisites

Galaxy installed at:

/home/galaxy/galaxy


Python virtual environment:

/home/galaxy/galaxy/.venv


Galaxy verified to start manually:

cd /home/galaxy/galaxy
source .venv/bin/activate
./run.sh

1. Create the Galaxy system user (if not already present)
sudo useradd -r -m -d /home/galaxy -s /bin/bash galaxy || true


Ensure ownership:

sudo chown -R galaxy:galaxy /home/galaxy/galaxy

2. Configure Galaxy network binding

Edit the Galaxy configuration:

sudo -u galaxy nano /home/galaxy/galaxy/config/galaxy.yml


Ensure the following values exist:

galaxy:
  host: 0.0.0.0
  port: 8080


This allows access from other machines on the network.

3. Create the systemd service file

Create the Galaxy service unit:

sudo tee /etc/systemd/system/galaxy.service >/dev/null <<'EOF'
[Unit]
Description=Galaxy Server
After=network.target
Wants=network.target

[Service]
Type=simple
User=galaxy
Group=galaxy
WorkingDirectory=/home/galaxy/galaxy

Environment="VIRTUAL_ENV=/home/galaxy/galaxy/.venv"
Environment="PATH=/home/galaxy/galaxy/.venv/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/bin"
Environment="NODE_OPTIONS=--max-old-space-size=4096"

ExecStart=/home/galaxy/galaxy/.venv/bin/python /home/galaxy/galaxy/scripts/common_startup.sh
ExecStop=/bin/kill -TERM $MAINPID

Restart=on-failure
RestartSec=10

StandardOutput=journal
StandardError=journal

NoNewPrivileges=true
PrivateTmp=true
ProtectSystem=full
ProtectHome=false
ReadWritePaths=/home/galaxy/galaxy

[Install]
WantedBy=multi-user.target
EOF

4. Enable and start the service
sudo systemctl daemon-reload
sudo systemctl enable --now galaxy


Check status:

sudo systemctl status galaxy --no-pager -l


View logs:

sudo journalctl -u galaxy -f

5. Verify Galaxy is listening
ss -tulpen | grep 8080


Test locally:

curl -I http://localhost:8080


From another machine:

http://<GALAXY_SERVER_IP>:8080

6. Firewall configuration (if enabled)
sudo firewall-cmd --add-port=8080/tcp --permanent
sudo firewall-cmd --reload

7. SELinux configuration (if Enforcing)

Check mode:

getenforce


If enforcing, allow Galaxy port:

sudo semanage port -a -t http_port_t -p tcp 8080 \
  || sudo semanage port -m -t http_port_t -p tcp 8080

8. Service management commands

Stop Galaxy:

sudo systemctl stop galaxy


Start Galaxy:

sudo systemctl start galaxy


Restart Galaxy:

sudo systemctl restart galaxy


Disable at boot:

sudo systemctl disable galaxy

Notes

This setup does not require internet access

Gravity is not required

Galaxy runs entirely under the galaxy user

Logs are available via journalctl

SQLite is suitable for testing; PostgreSQL is recommended for production





by default Galaxy is restricted, and what you‚Äôre seeing is exactly what happens when it‚Äôs only listening on localhost.
Turning off the firewall alone is not sufficient.

Let‚Äôs go through this cleanly and quickly.

‚úÖ Why you can ping but not connect

Ping only proves:

IP routing works

The VM is reachable at Layer 3

It does not mean:

Galaxy is listening on the network

The port is open

SELinux allows it

The service is bound to the correct interface

Galaxy defaults to 127.0.0.1 unless told otherwise.

üîç Step 1 ‚Äî Confirm what Galaxy is listening on

On the Galaxy VM, run:

ss -tulpen | grep galaxy


or more generally:

ss -tulpen | grep 8080

If you see:
127.0.0.1:8080


‚û°Ô∏è Only local connections allowed (this is your issue)

You want to see:
0.0.0.0:8080


or

<VM-IP>:8080

üõ†Ô∏è Step 2 ‚Äî Configure Galaxy to listen on all interfaces

Edit your Galaxy config:

nano /home/galaxy/galaxy/config/galaxy.yml


Set (or add):

galaxy:
  host: 0.0.0.0
  port: 8080


Or older-style config (still valid):

server:
  bind: 0.0.0.0:8080


‚ö†Ô∏è Do not use 127.0.0.1

üîÑ Step 3 ‚Äî Restart Galaxy

As the galaxy user:

cd /home/galaxy/galaxy
source .venv/bin/activate
galaxy stop
galaxy start


(or ./run.sh if using that)

Recheck:

ss -tulpen | grep 8080

üåê Step 4 ‚Äî Test locally on the VM

From the VM itself:

curl http://localhost:8080


You should get HTML output.

üåç Step 5 ‚Äî Test from another machine

From another PC on the same network:

http://<VM-IP>:8080


Example:

http://192.168.1.50:8080

üîê Step 6 ‚Äî SELinux (very common on RHEL)

Even with firewall off, SELinux can still block traffic.

Check mode:

getenforce

If it says Enforcing (likely):

Temporarily test:

sudo setenforce 0


If that fixes it ‚Üí SELinux policy is blocking Galaxy.

Proper fix (recommended):
sudo semanage port -a -t http_port_t -p tcp 8080


(install if missing: dnf install policycoreutils-python-utils)

üß± Step 7 ‚Äî Firewall (when you turn it back on)

When ready:

sudo firewall-cmd --add-port=8080/tcp --permanent
sudo firewall-cmd --reload

üñ•Ô∏è VMware-specific checks (very important)

Since you‚Äôre using VMware Workstation:

Network adapter MUST be:

Bridged (preferred), or

NAT with port forwarding

Check:

ip addr show


Make sure the VM has an IP on the same subnet as your PC.

‚ùå What Galaxy does NOT restrict by default

Galaxy does not restrict by:

Source IP

Subnet

Hostname

If it‚Äôs listening on 0.0.0.0 and the port is reachable, any IP can connect unless you configure auth or reverse proxies.

‚úÖ Quick checklist (90% of issues)

‚úîÔ∏è Galaxy bound to 0.0.0.0
‚úîÔ∏è Port 8080 listening
‚úîÔ∏è SELinux not blocking
‚úîÔ∏è Firewall allows 8080
‚úîÔ∏è VM network is bridged/NAT-forwarded

üîí Later (recommended for production)

Once testing is done, you‚Äôll likely want:

Reverse proxy (nginx)

TLS

IP restrictions

Authentication hardening

I can help with that when you‚Äôre ready.

üí° TL;DR (most likely fix)

Your Galaxy is listening on 127.0.0.1.
Set host: 0.0.0.0, restart, and it will work.

If you want, paste the output of:

ss -tulpen | grep 8080


and I‚Äôll confirm it instantly.
